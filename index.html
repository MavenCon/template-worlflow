<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Maven ä»“åº“æµè§ˆå™¨</title>
	<style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            border-bottom: 1px solid #eaecef;
            padding-bottom: 0.3em;
        }

        .breadcrumb {
            margin-bottom: 20px;
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
        }

        .breadcrumb a {
            text-decoration: none;
            color: #0366d6;
            margin: 0 5px;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 8px;
            background-color: #f8f9fa;
            border-bottom: 2px solid #dfe2e5;
        }

        td {
            padding: 8px;
            border-bottom: 1px solid #dfe2e5;
        }

        tr:hover {
            background-color: #f6f8fa;
        }

        .folder {
            font-weight: bold;
            color: #0366d6;
        }

        .file {
            color: #24292e;
        }

        .folder:before {
            content: "ğŸ“ ";
        }

        .file:before {
            content: "ğŸ“„ ";
        }

        .loading {
            text-align: center;
            font-size: 1.2em;
            margin: 40px;
        }
	</style>
</head>
<body>
<h1>Maven ä»“åº“æµè§ˆå™¨</h1>
<div id="breadcrumb" class="breadcrumb">
	<a href="#" onclick="navigate('')">é¦–é¡µ</a>
</div>
<div id="content">
	<div class="loading">åŠ è½½ä¸­...</div>
</div>

<script>
	let currentPath = '';

	// é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
	window.onload = function () {
		// è·å–å¹¶å¤„ç†URLä¸­çš„è·¯å¾„å‚æ•°
		const urlParams = new URLSearchParams(window.location.search);
		const path = urlParams.get('path') || '';
		navigate(path);

		// æ·»åŠ æµè§ˆå™¨å†å²å¯¼èˆªæ”¯æŒ
		window.onpopstate = function (event) {
			if (event.state && event.state.path !== undefined) {
				navigateWithoutHistory(event.state.path);
			} else {
				navigateWithoutHistory('');
			}
		};
	};

	// å¯¼èˆªåˆ°æŒ‡å®šè·¯å¾„
	function navigate(path) {
		history.pushState({path: path}, '', path ? `?path=${encodeURIComponent(path)}` : '');
		navigateWithoutHistory(path);
	}

	// ä¸ä¿®æ”¹æµè§ˆå†å²çš„å¯¼èˆªå‡½æ•°
	function navigateWithoutHistory(path) {
		currentPath = path;
		updateBreadcrumbs();
		listDirectory(path);
	}

	// æ›´æ–°é¢åŒ…å±‘å¯¼èˆª
	function updateBreadcrumbs() {
		const breadcrumb = document.getElementById('breadcrumb');
		breadcrumb.innerHTML = '<a href="#" onclick="navigate(\'\'); return false;">é¦–é¡µ</a>';

		if (currentPath) {
			const parts = currentPath.split('/');
			let cumulativePath = '';

			for (let i = 0; i < parts.length; i++) {
				if (parts[i]) {
					cumulativePath += (cumulativePath ? '/' : '') + parts[i];
					breadcrumb.innerHTML += ' / <a href="#" onclick="navigate(\'' + cumulativePath + '\'); return false;">' + parts[i] + '</a>';
				}
			}
		}
	}

	// åˆ—å‡ºç›®å½•å†…å®¹
	function listDirectory(path) {
		const contentDiv = document.getElementById('content');
		contentDiv.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';

		// æ„å»ºåŸºäºç›¸å¯¹è·¯å¾„çš„URL
		const baseUrl = path ? path + '/' : '';

		// ä½¿ç”¨fetch APIè·å–ç›®å½•åˆ—è¡¨
		fetch(baseUrl)
			.then(response => response.text())
			.then(html => {
				// è§£æHTMLæ¥æå–ç›®å½•å’Œæ–‡ä»¶
				const parser = new DOMParser();
				const doc = parser.parseFromString(html, 'text/html');
				const links = Array.from(doc.querySelectorAll('a'));

				// è¿‡æ»¤æ‰çˆ¶ç›®å½•é“¾æ¥å’Œå…¶ä»–éæ–‡ä»¶/æ–‡ä»¶å¤¹é¡¹
				const items = links.filter(a => {
					const href = a.getAttribute('href');
					return href !== '../' && href !== './' && href !== 'index.html' && !href.startsWith('?') && !href.startsWith('http');
				});

				if (items.length === 0) {
					contentDiv.innerHTML = '<p>æ­¤ç›®å½•ä¸ºç©ºæˆ–æ— æ³•è®¿é—®ã€‚</p>';
					return;
				}

				// åˆ›å»ºè¡¨æ ¼æ¥æ˜¾ç¤ºå†…å®¹
				let tableHTML = `
                        <table>
                            <thead>
                                <tr>
                                    <th>åç§°</th>
                                    <th>æœ€åä¿®æ”¹æ—¶é—´</th>
                                    <th>å¤§å°</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;

				// å…ˆå¤„ç†æ–‡ä»¶å¤¹
				const folders = items.filter(a => a.getAttribute('href').endsWith('/'));
				folders.forEach(a => {
					const name = a.textContent.replace('/', '');
					tableHTML += `
                            <tr>
                                <td><a href="#" class="folder" onclick="navigate('${currentPath ? currentPath + '/' : ''}${name}'); return false;">${name}</a></td>
                                <td>-</td>
                                <td>-</td>
                            </tr>
                        `;
				});

				// å†å¤„ç†æ–‡ä»¶
				const files = items.filter(a => !a.getAttribute('href').endsWith('/'));
				files.forEach(a => {
					const name = a.textContent;
					const href = a.getAttribute('href');
					tableHTML += `
                            <tr>
                                <td><a href="${baseUrl}${href}" class="file" target="_blank">${name}</a></td>
                                <td>-</td>
                                <td>-</td>
                            </tr>
                        `;
				});

				tableHTML += '</tbody></table>';
				contentDiv.innerHTML = tableHTML;
			})
			.catch(error => {
				contentDiv.innerHTML = `<p>åŠ è½½é”™è¯¯: ${error.message}</p>`;
			});
	}
</script>
</body>
</html>
