<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Maven ä»“åº“æµè§ˆå™¨</title>
	<style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            border-bottom: 1px solid #eaecef;
            padding-bottom: 0.3em;
        }

        .breadcrumb {
            margin-bottom: 20px;
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
        }

        .breadcrumb a {
            text-decoration: none;
            color: #0366d6;
            margin: 0 5px;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 8px;
            background-color: #f8f9fa;
            border-bottom: 2px solid #dfe2e5;
        }

        td {
            padding: 8px;
            border-bottom: 1px solid #dfe2e5;
        }

        tr:hover {
            background-color: #f6f8fa;
        }

        .folder {
            font-weight: bold;
            color: #0366d6;
        }

        .file {
            color: #24292e;
        }

        .folder:before {
            content: "ğŸ“ ";
        }

        .file:before {
            content: "ğŸ“„ ";
        }

        .loading {
            text-align: center;
            font-size: 1.2em;
            margin: 40px;
        }
	</style>
</head>
<body>
<h1>Maven ä»“åº“æµè§ˆå™¨</h1>
<div id="breadcrumb" class="breadcrumb">
	<!-- é¢åŒ…å±‘å¯¼èˆªå°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
</div>
<div id="content">
	<div class="loading">åŠ è½½ä¸­...</div>
</div>

<script>
	// å…¨å±€å˜é‡ï¼Œå­˜å‚¨å½“å‰è·¯å¾„
	let currentPath = '';

	// é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
	window.onload = function () {
		// è·å–å¹¶å¤„ç†URLä¸­çš„è·¯å¾„å‚æ•°
		const urlParams = new URLSearchParams(window.location.search);
		const path = urlParams.get('path') || '';
		navigate(path);

		// æ·»åŠ æµè§ˆå™¨å†å²å¯¼èˆªæ”¯æŒ
		window.onpopstate = function (event) {
			if (event.state && event.state.path !== undefined) {
				navigateWithoutHistory(event.state.path);
			} else {
				navigateWithoutHistory('');
			}
		};
	};

	// å¯¼èˆªåˆ°æŒ‡å®šè·¯å¾„ - æ·»åŠ åˆ°æµè§ˆå™¨å†å²
	function navigate(path) {
		// è§„èŒƒåŒ–è·¯å¾„æ ¼å¼
		path = normalizePath(path);
		history.pushState({path: path}, '', path ? `?path=${encodeURIComponent(path)}` : '');
		navigateWithoutHistory(path);
	}

	// ä¸ä¿®æ”¹æµè§ˆå†å²çš„å¯¼èˆªå‡½æ•°
	function navigateWithoutHistory(path) {
		// è§„èŒƒåŒ–è·¯å¾„æ ¼å¼
		path = normalizePath(path);
		currentPath = path;
		updateBreadcrumbs();
		listDirectory(path);
	}

	// è§„èŒƒåŒ–è·¯å¾„æ ¼å¼ï¼Œç¡®ä¿è·¯å¾„æ ¼å¼ä¸€è‡´
	function normalizePath(path) {
		// ç§»é™¤å¼€å¤´å’Œç»“å°¾çš„æ–œæ 
		path = path.replace(/^\/+|\/+$/g, '');
		// ç»Ÿä¸€å¤„ç†å¤šä¸ªè¿ç»­æ–œæ ä¸ºå•ä¸ªæ–œæ 
		path = path.replace(/\/+/g, '/');
		return path;
	}

	// æ„å»ºå®Œæ•´URLè·¯å¾„
	function buildUrl(path) {
		return path ? path + '/' : '';
	}

	// æ›´æ–°é¢åŒ…å±‘å¯¼èˆª
	function updateBreadcrumbs() {
		const breadcrumb = document.getElementById('breadcrumb');
		// æ¸…ç©ºå½“å‰é¢åŒ…å±‘
		breadcrumb.innerHTML = '<a href="#" onclick="navigate(\'\'); return false;">æ ¹ç›®å½•</a>';

		// å¦‚æœå½“å‰ä¸æ˜¯æ ¹ç›®å½•ï¼Œåˆ™æ˜¾ç¤ºè·¯å¾„
		if (currentPath) {
			const parts = currentPath.split('/');
			let cumulativePath = '';

			for (let i = 0; i < parts.length; i++) {
				if (parts[i]) {
					cumulativePath += (cumulativePath ? '/' : '') + parts[i];
					breadcrumb.innerHTML += ' / <a href="#" onclick="navigate(\'' + cumulativePath + '\'); return false;">' + parts[i] + '</a>';
				}
			}
		}
	}

	// åˆ—å‡ºç›®å½•å†…å®¹
	function listDirectory(path) {
		const contentDiv = document.getElementById('content');
		contentDiv.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';

		// æ„å»ºåŸºäºç›¸å¯¹è·¯å¾„çš„URL
		const baseUrl = buildUrl(path);

		// ä½¿ç”¨fetch APIè·å–ç›®å½•åˆ—è¡¨
		fetch(baseUrl)
			.then(response => response.text())
			.then(html => {
				// è§£æHTMLæ¥æå–ç›®å½•å’Œæ–‡ä»¶
				const parser = new DOMParser();
				const doc = parser.parseFromString(html, 'text/html');
				const links = Array.from(doc.querySelectorAll('a'));

				// è¿‡æ»¤æ‰çˆ¶ç›®å½•é“¾æ¥å’Œå…¶ä»–éæ–‡ä»¶/æ–‡ä»¶å¤¹é¡¹
				const items = links.filter(a => {
					const href = a.getAttribute('href');
					return href !== './' && href !== 'index.html' && !href.startsWith('?') && !href.startsWith('http');
				});

				// åˆ›å»ºç»Ÿä¸€çš„æ•°æ®ç»“æ„
				const fileList = [];

				// å¦‚æœä¸æ˜¯æ ¹ç›®å½•ï¼Œæ·»åŠ è¿”å›ä¸Šçº§ç›®å½•é€‰é¡¹
				if (currentPath) {
					// è®¡ç®—ä¸Šä¸€çº§ç›®å½•çš„è·¯å¾„
					const parentPath = currentPath.includes('/')
						? currentPath.substring(0, currentPath.lastIndexOf('/'))
						: '';

					fileList.push({
						name: '..',
						isFolder: true,
						href: '../',
						isParent: true,
						parentPath: parentPath // å­˜å‚¨çˆ¶ç›®å½•è·¯å¾„ï¼Œé¿å…é‡å¤è®¡ç®—
					});
				}

				// å¤„ç†å½“å‰ç›®å½•çš„å†…å®¹
				items.forEach(a => {
					const href = a.getAttribute('href');
					// å¿½ç•¥çˆ¶ç›®å½•é“¾æ¥ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»æ‰‹åŠ¨æ·»åŠ äº†
					if (href !== '../') {
						const name = a.textContent.replace('/', '');
						const isFolder = href.endsWith('/');

						fileList.push({
							name: name,
							isFolder: isFolder,
							href: href,
							isParent: false
						});
					}
				});

				if (fileList.length === 0) {
					contentDiv.innerHTML = '<p>æ­¤ç›®å½•ä¸ºç©ºæˆ–æ— æ³•è®¿é—®ã€‚</p>';
					return;
				}

				// æ’åºï¼šçˆ¶ç›®å½•å§‹ç»ˆåœ¨æœ€ä¸Šæ–¹ï¼Œç„¶åæ˜¯æ–‡ä»¶å¤¹ï¼Œç„¶åæ˜¯æ–‡ä»¶ï¼Œéƒ½æŒ‰å­—æ¯é¡ºåºæ’åº
				fileList.sort((a, b) => {
					// çˆ¶ç›®å½•ä¼˜å…ˆ
					if (a.isParent) return -1;
					if (b.isParent) return 1;

					// æ–‡ä»¶å¤¹ä¼˜å…ˆäºæ–‡ä»¶
					if (a.isFolder && !b.isFolder) return -1;
					if (!a.isFolder && b.isFolder) return 1;

					// ç›¸åŒç±»å‹æŒ‰åç§°å­—æ¯é¡ºåºæ’åº
					return a.name.localeCompare(b.name);
				});

				// åˆ›å»ºè¡¨æ ¼æ¥æ˜¾ç¤ºå†…å®¹
				let tableHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>åç§°</th>
                                <th>æœ€åä¿®æ”¹æ—¶é—´</th>
                                <th>å¤§å°</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

				// ç»Ÿä¸€å¤„ç†æ‰€æœ‰æ¡ç›®
				fileList.forEach(item => {
					if (item.isFolder) {
						if (item.isParent) {
							// å¤„ç†è¿”å›ä¸Šçº§ç›®å½•ï¼Œä½¿ç”¨å·²å­˜å‚¨çš„ parentPath
							tableHTML += `
                                <tr>
                                    <td><a href="#" class="folder" onclick="navigate('${item.parentPath}'); return false;">è¿”å›ä¸Šçº§ç›®å½•</a></td>
                                    <td>-</td>
                                    <td>-</td>
                                </tr>
                            `;
						} else {
							// å¤„ç†æ™®é€šæ–‡ä»¶å¤¹
							const itemPath = currentPath
								? `${currentPath}/${item.name}`
								: item.name;

							tableHTML += `
                                <tr>
                                    <td><a href="#" class="folder" onclick="navigate('${itemPath}'); return false;">${item.name}</a></td>
                                    <td>-</td>
                                    <td>-</td>
                                </tr>
                            `;
						}
					} else {
						// å¤„ç†æ–‡ä»¶
						tableHTML += `
                            <tr>
                                <td><a href="${baseUrl}${item.href}" class="file" target="_blank">${item.name}</a></td>
                                <td>-</td>
                                <td>-</td>
                            </tr>
                        `;
					}
				});

				tableHTML += '</tbody></table>';
				contentDiv.innerHTML = tableHTML;
			})
			.catch(error => {
				contentDiv.innerHTML = `<p>åŠ è½½é”™è¯¯: ${error.message}</p>`;
			});
	}
</script>
</body>
</html>
